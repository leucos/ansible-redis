- name: Get changes in sentinel.conf
  command: awk '/# Generated by CONFIG REWRITE/{y=1}y' /etc/redis/sentinel.conf
  always_run: true
  register: __redis_sentinel_trailer

- name: Deploy sentinel template
  template:
    src: sentinel.conf.j2
    dest: /etc/redis/sentinel.conf
    mode: 0664
    owner: redis
    group: redis
    backup: yes
  notify: Restart sentinel

- name: Adds sentinel init script
  template: 
    src: sentinel.init.j2
    dest: /etc/init.d/redis-sentinel
    mode: 0755
    owner: root
    group: root
  notify: Restart sentinel

- name: Set sentinel to start at boot
  service:
    name: redis-sentinel
    enabled: yes
